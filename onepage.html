<style>


  #testApp table, th, td {
    border-collapse: collapse;
    border: 1px solid black;
    padding: 10px;
  }
</style>

<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>


<div class="" id="firstInfo">

</div>

<div id="testApp" class="">
  <table id="rankTable">
    <thead>
      <td>Rank</td>
      <td>Athlete</td>
      <td>Distance</td>
      <td>Moving Time</td>
      <td>Elapsed Time</td>
      <td>Elev. Gain</td>
    </thead>

  </table>
</div>


<!-- <script src=strava_api.js></script> -->

<script type="text/javascript">
  // var x = "asdf";
  // var getInfo = function() {
  //   const link = "https://www.strava.com/api/v3/athlete/activities?access_token=0bd793a821f6cc75aeec8f076e0aeaec350016b2";
  //   console.log("===============");
  //   fetch(link)
  //     .then((res) => console.warn(res.json()));
  // }
  //
  // getInfo();

  var accessToken = "";
  var refreshToken = "";


  var getFirst = function() {
    return new Promise(function(resolve, reject) {
      $.ajax({
        type: "POST",
        url: "https://www.strava.com/oauth/token?client_id=11052&client_secret=0689beebbf2bc637783d4d9d97f298afa28280a4&refresh_token=ea0ed7faa7240af9cb5b5a563a374b9fedbd2191&grant_type=refresh_token",
        success: function(result) {
          var result = result;
          console.log(result);
          accessToken = result.access_token;
          refreshToken = result.refresh_token;
          $("#firstInfo").append("<p>result.token_type: " + result.token_type + "</p>");
          $("#firstInfo").append("<p>result.access_token: " + accessToken + "</p>");
          $("#firstInfo").append("<p>result.refresh_token: " + refreshToken + "</p>");
          resolve(accessToken);
        }
      })
    })
  };


  var getMyStuff = function(accessToken) {
    console.warn(accessToken);
    $.ajax({
      type: "GET",
      url: "https://www.strava.com/api/v3/athlete/activities?access_token=" + accessToken,
      // headers: {
      //   "Authorization": "Bearer 4933dc6ae6bc08b3ad1a754e06f6cd797b16f56e"
      // },
      success: function(result) {
        console.warn(result);
      },
      error: function(err) {
        throw "getMyStuff failed";
      }
    })
  };
  // getMyStuff(accessToken);


  var doIt = function() {
    $.ajax({
      // url: "https://www.strava.com/api/v3/athlete/activities?access_token=0bd793a821f6cc75aeec8f076e0aeaec350016b2",
      url: "https://www.strava.com/api/v3/clubs/votary/activities?access_token=" + accessToken,
      success: function(result) {
        console.log(result);
        // $("testApp").html(result);
        result = result.sort(function(a, b) {
          return b.distance - a.distance;
        }); // longest distance first
        console.log(result);
        for (var i = 0; i < result.length; i++) {
          $("#rankTable").append("<tr class='result'><td clas='rank'>" + (i + 1) + "<td class='athlete'>" + result[i]["athlete"]["firstname"] + " " + result[i]["athlete"]["lastname"] + "</td><td class='distance'>" + result[i]["distance"] +
            "</td><td class='moving_time'>" + result[i]["moving_time"] + "</td><td class='elapsed_time'>" + result[i]["elapsed_time"] + "</td><td class='total_elevation_gain'>" + result[i]["total_elevation_gain"] + "</td></tr>")
        }
        // $("#rankTable").append("<tr>"++"<td></td>"++"<td></td>"++"<td></td>"++"<td></td>"++"<td></td>"++"<td></td>"++"<td></td></tr>")
      }
    });
  };


  var errorHandler = function(){
    throw "failure";
  }

  document.addEventListener("DOMContentLoaded", function() {
    getFirst()
      .then(doIt)
      .catch(errorHandler)
  })
</script>





<iframe id="stravaWidget" allowtransparency frameborder='0' scrolling='no' src='https://www.strava.com/clubs/619204/latest-rides/51be75ece0f4cec07016c2982de0e78949dbbdf1?show_rides=true' width='100%'></iframe>
